<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Product Editor - Vastramaya</title>

<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --header-height-desktop: 70px;
  --sidebar-width: 260px;
  --row-height: 48px;

  --sidebar-bg: #ffffff;
  --header-bg: #ffffff;
  --page-bg: #f4f5f7;

  --text-color: rgb(24, 24, 26);
  --icon-color: #6b7280;
  --icon-active: #5127ba;

  --active-bg: #f3f4f6;
  --hover-bg: #f3f4f6;

  --border-subtle: #e5e7eb;
  
  /* Additional colors for editor */
  --primary-purple: #5127ba;
  --primary-purple-hover: #471ea7;
  --accent-purple: #673de6;
  --danger-color: #EF4444;
  --success-color: #10B981;
  --star-color: #EF4444;
  
  /* Shadows */
  --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
  
  /* Border radius */
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 24px;
  
  /* Transition */
  --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* RESET */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  min-height: 100vh;
  background: var(--page-bg);
  font-family: "DM Sans", Roboto, sans-serif;
  font-weight: 500;
  font-size: 14px;
  line-height: 20px;
  color: var(--text-color);
  overflow-x: hidden;
}

/* ============= DESKTOP LAYOUT ============= */

.page-desktop {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Desktop header */
.d-topbar {
  height: var(--header-height-desktop);
  background: var(--header-bg);
  border-bottom: 1px solid var(--border-subtle);
  border-top: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  padding-left: 40px;
}

.d-topbar-logo {
  height: 52px;
  width: auto;
  object-fit: contain;
}

/* Desktop main area */
.d-app {
  flex: 1;
  display: flex;
}

/* Desktop sidebar */
.d-sidebar {
  width: var(--sidebar-width);
  background: var(--sidebar-bg);
  border-right: 1px solid var(--border-subtle);
  display: flex;
  flex-direction: column;
}

.d-sidebar-inner {
  padding: 32px 16px 16px 12px;
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Desktop nav */
.d-nav {
  display: flex;
  flex-direction: column;
}

.d-nav-group + .d-nav-group {
  margin-top: 6px;
}

.d-nav-item {
  display: flex;
  align-items: center;
  height: var(--row-height);
  padding: 0 20px 0 12px;
  margin: 2px 0;
  border-radius: 8px;
  gap: 12px;
  cursor: pointer;
  font-weight: 500;
  font-size: 14px;
  color: var(--text-color);
  line-height: 20px;
  transition: background 0.15s ease;
  text-decoration: none;
}

/* label takes remaining space so chevron sticks right */
.d-nav-item .label {
  flex: 1;
}

.d-nav-item .icon svg {
  width: 22px;
  height: 22px;
  stroke: var(--icon-color);
}

/* chevron icon (desktop + mobile shared class) */
.chevron-icon {
  width: 18px;
  height: 18px;
  stroke: var(--icon-color);
  transition: transform 0.2s ease;
}

/* rotated when open */
.dropdown-open .chevron-icon {
  transform: rotate(90deg);
}

/* Desktop active */
.d-nav-item--active {
  background: var(--active-bg);
}
.d-nav-item--active .icon svg {
  stroke: var(--icon-active);
}

/* Desktop hover */
.d-nav-item:hover {
  background: var(--hover-bg);
}

/* Desktop Customize Site submenu */
.d-submenu {
  display: none;
  margin-left: 28px;
  padding-left: 16px;
  border-left: 1px solid var(--border-subtle);
  margin-top: 4px;
}
.d-submenu.open {
  display: block;
}
.d-submenu-item {
  height: 40px;
  display: flex;
  align-items: center;
  padding: 0 16px;
  border-radius: 8px;
  margin: 2px 0;
  cursor: pointer;
  font-size: 13px;
  color: var(--text-color);
}
.d-submenu-item:hover {
  background: var(--hover-bg);
}
.d-submenu-item.active {
  background: var(--active-bg);
}

/* Desktop account section */
.d-account-section {
  margin-top: auto;
  padding: 16px;
  border-top: 1px solid var(--border-subtle);
}

/* Shared Account card styles (desktop + mobile) */
.account-card {
  display: flex;
  align-items: center;
  gap: 12px;
}

.account-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--border-subtle);
}

.account-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.account-name {
  font-size: 14px;
  font-weight: 500;
}

.account-email {
  font-size: 12px;
  color: #6b7280;
}

/* Desktop content */
.d-content {
  flex: 1;
  background: var(--page-bg);
  overflow-y: auto;
  height: calc(100vh - 70px);
}

/* ============= BODY CONTENT ============= */

.content-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 24px 40px;
  width: 100%;
}

/* Top title + button row (desktop only uses button; mobile no button here) */
.page-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 24px;
}

.page-title-wrap {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* "Domain portfolio" main title */
.page-title {
  font-family: "DM Sans", Roboto, sans-serif;
  font-weight: 700;
  font-size: 20px;
  line-height: 32px;
  color: rgb(29, 30, 32);
}

/* Breadcrumb */
.breadcrumb {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  line-height: 20px;
  color: #6b7280;
}

.breadcrumb-icon svg {
  width: 16px;
  height: 16px;
  stroke: #9ca3af;
}

.breadcrumb-divider {
  color: #d1d5db;
}

/* Add domain button */
.primary-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-family: "DM Sans", Roboto, sans-serif;
  font-weight: 600;
  font-size: 14px;
  line-height: 20px;
  color: #ffffff;
  background: #5127ba;
  transition: background 0.15s ease;
}
.primary-btn svg {
  width: 18px;
  height: 18px;
  stroke: #ffffff;
}
.primary-btn:hover {
  background: #471ea7;
}

/* small version for mobile card header */
.primary-btn-sm {
  padding: 8px 12px;
  white-space: nowrap;
}

/* Card */
.editor-card {
  background: #ffffff;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  overflow: hidden;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow-sm);
}

/* Card search header - desktop */
.card-header {
  padding: 16px 20px;
  border-bottom: 1px solid #e5e7eb;
}

/* Mobile card-header layout (search left, button right) */
.card-header-mobile {
  display: flex;
  align-items: center;
  gap: 8px;
}
.card-header-mobile .search-input-wrap {
  flex: 1;
}

.search-input-wrap {
  background: #f9fafb;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  padding: 0 16px;
  height: 40px;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: border-color 0.15s ease;
}

.search-input-wrap:focus-within {
  border-color: #673de6;
}

.search-icon {
  width: 16px;
  height: 16px;
  stroke: #9ca3af;
}

.search-input-wrap input {
  border: none;
  background: transparent;
  outline: none;
  flex: 1;
  font-family: "DM Sans", Roboto, sans-serif;
  font-size: 14px;
}

/* Form styles */
.section-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 1.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-color);
}

.form-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
}

.form-col {
  display: flex;
  flex-direction: column;
}

.input-group {
  margin-bottom: 1.25rem;
}

.input-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
}

.form-control {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  background: #fff;
  transition: var(--transition);
  font-size: 0.95rem;
}

.form-control:focus {
  border-color: var(--accent-purple);
  box-shadow: 0 0 0 3px rgba(103, 61, 230, 0.1);
}

/* Upload zone */
.upload-zone {
  border: 2px dashed #CBD5E1;
  border-radius: var(--radius-md);
  padding: 2rem 1rem;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  background: #F8FAFC;
}

.upload-zone:hover {
  border-color: var(--accent-purple);
  background: #EFF6FF;
}

/* Cover preview */
.cover-preview-wrapper {
  position: relative;
  width: 100%;
  border-radius: var(--radius-md);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
}

.cover-preview-img {
  width: 100%;
  height: auto;
  display: block;
  max-height: 400px;
  object-fit: cover;
}

.cover-remove-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255,255,255,0.9);
  color: var(--danger-color);
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  transition: var(--transition);
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: var(--transition);
  border: none;
  font-size: 0.95rem;
}

.btn-primary {
  background: var(--primary-purple);
  color: white;
  box-shadow: var(--shadow-md);
}

.btn-primary:hover {
  background: var(--primary-purple-hover);
}

.btn-secondary {
  background: white;
  border: 1px solid var(--border-subtle);
  color: var(--text-primary);
}

.btn-secondary:hover {
  background: var(--hover-bg);
}

.btn-sm {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.btn-icon {
  padding: 0.5rem;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: 6px;
  font-size: 1.2rem;
}

.btn-danger-icon {
  color: var(--danger-color);
}

/* Toggle switch */
.toggle {
  position: relative;
  width: 40px;
  height: 22px;
  border-radius: 999px;
  background: #e5e7eb;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  padding: 0 2px;
  transition: background 0.15s ease;
}
.toggle-inner {
  width: 18px;
  height: 18px;
  border-radius: 999px;
  background: #ffffff;
  transition: transform 0.15s ease;
}

/* active toggle */
.toggle.on {
  background: #7c3aed;
}
.toggle.on .toggle-inner {
  transform: translateX(18px);
}

/* Buttons in actions */
.action-buttons {
  display: inline-flex;
  gap: 8px;
  align-items: center;
}

/* kebab menu */
.kebab {
  width: 24px;
  height: 24px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.kebab-dots {
  width: 4px;
  height: 4px;
  border-radius: 999px;
  background: #a855f7;
  box-shadow: 0 -6px 0 0 #a855f7, 0 6px 0 0 #a855f7;
}

/* ============= MOBILE LAYOUT ============= */

.page-mobile {
  min-height: 100vh;
  display: none;
  flex-direction: column;
}

/* Mobile header */
.m-header {
  height: 72px;
  background: var(--header-bg);
  border-bottom: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  position: sticky;
  top: 0;
  z-index: 100;
}

/* Menu button left - rounded 6px */
.m-menu-btn {
  width: 36px;
  height: 36px;
  border-radius: 6px;
  border: 1px solid var(--border-subtle);
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.m-menu-lines {
  width: 18px;
  height: 14px;
  position: relative;
}
.m-menu-lines::before,
.m-menu-lines::after,
.m-menu-lines span {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;
  border-radius: 999px;
  background: #111827;
}
.m-menu-lines::before {
  top: 0;
}
.m-menu-lines span {
  top: 6px;
}
.m-menu-lines::after {
  bottom: 0;
}

/* Logo right (48px) */
.m-logo {
  height: 48px;
  width: auto;
  object-fit: contain;
}

/* Mobile main bg */
.m-main {
  flex: 1;
  background: var(--page-bg);
  overflow-y: auto;
}

/* Overlay & drawer (smooth animation) */
.m-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.45);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease-out;
  z-index: 40;
}

.m-overlay.open {
  opacity: 1;
  pointer-events: auto;
}

.m-drawer {
  position: absolute;
  left: 0;
  top: 0;
  width: 320px;
  max-width: 90vw;
  height: 100%;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  transform: translateX(-100%);
  transition: transform 0.25s ease-out;
}

.m-overlay.open .m-drawer {
  transform: translateX(0);
}

/* Drawer header */
.m-drawer-header {
  height: 72px;
  border-bottom: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
}

/* Drawer logo also 48px */
.m-drawer-logo {
  height: 48px;
  width: auto;
  object-fit: contain;
}

.m-drawer-close {
  width: 40px;
  height: 40px;
  border: 0px;
  background: #f9fafb;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: var(--radius-md);
}
.m-drawer-close-icon {
  width: 14px;
  height: 14px;
  position: relative;
}
.m-drawer-close-icon::before,
.m-drawer-close-icon::after {
  content: "";
  position: absolute;
  inset: 0;
  margin: auto;
  width: 14px;
  height: 2px;
  border-radius: 999px;
  background: #111827;
}
.m-drawer-close-icon::before {
  transform: rotate(45deg);
}
.m-drawer-close-icon::after {
  transform: rotate(-45deg);
}

/* Drawer nav */
.m-drawer-nav {
  padding: 32px 8px;
  display: flex;
  flex-direction: column;
}

.m-nav-item {
  display: flex;
  align-items: center;
  height: var(--row-height);
  padding: 0 16px;
  margin: 2px 0;
  border-radius: 8px;
  gap: 12px;
  cursor: pointer;
  color: var(--text-color);
  transition: background 0.15s ease;
  text-decoration: none;
}

.m-nav-item .label {
  flex: 1;
}

.m-nav-item .icon svg {
  width: 22px;
  height: 22px;
  stroke: var(--icon-color);
}

/* active mobile */
.m-nav-item.active {
  background: var(--active-bg);
}
.m-nav-item.active .icon svg {
  stroke: var(--icon-active);
}

/* Mobile submenu */
.m-submenu {
  display: none;
  margin-left: 28px;
  padding-left: 16px;
  border-left: 1px solid var(--border-subtle);
  margin-top: 4px;
}
.m-submenu.open {
  display: block;
}
.m-submenu-item {
  height: 40px;
  display: flex;
  align-items: center;
  padding: 0 16px;
  border-radius: 8px;
  margin: 2px 0;
  cursor: pointer;
  font-size: 13px;
}
.m-submenu-item:hover {
  background: var(--hover-bg);
}
.m-submenu-item.active {
  background: var(--active-bg);
}

/* Drawer footer account - same style as desktop */
.m-account-section {
  margin-top: auto;
  padding: 16px;
  border-top: 1px solid var(--border-subtle);
}

/* Mobile Product Cards */
.mobile-cards {
  padding: 12px 16px 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.product-card {
  background: #ffffff;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  padding: 12px 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.product-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.product-card-header .product-name {
  font-weight: 500;
}

.product-card-menu-btn {
  border: none;
  background: transparent;
  padding: 0;
  cursor: pointer;
}

.product-card-main {
  display: flex;
  gap: 10px;
}

.product-meta {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  gap: 4px;
}

.product-count-sm {
  font-size: 13px;
  color: rgb(59,61,74);
}

.status-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.status-label {
  font-size: 13px;
  color: rgb(107,114,128);
}

.product-card-footer {
  margin-top: 6px;
}

/* Mobile save bar */
.mobile-save-bar {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: white;
  padding: 1rem;
  border-top: 1px solid var(--border-subtle);
  z-index: 90;
  box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.05);
}

/* ============= MODALS & POPUPS ============= */

/* bottom sheet for mobile card menu */
.sheet-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.45);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease-out;
  z-index: 80;
}

.sheet-overlay.open {
  opacity: 1;
  pointer-events: auto;
}

.bottom-sheet {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  background: #ffffff;
  border-radius: 16px 16px 0 0;
  padding: 16px 16px 12px;
  box-shadow: 0 -12px 30px rgba(15,23,42,0.25);
  transform: translateY(100%);
  transition: transform 0.2s ease-out;
}

.sheet-overlay.open .bottom-sheet {
  transform: translateY(0);
}

.sheet-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

.sheet-title {
  font-weight: 600;
  font-size: 14px;
}

.sheet-close-btn {
  border: none;
  background: #f3f4f6;
  border-radius: 999px;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.sheet-close-btn span {
  font-size: 16px;
  line-height: 1;
}

.sheet-actions {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-top: 4px;
}

.sheet-action {
  padding: 8px 4px;
  text-align: left;
  border-radius: 8px;
  border: none;
  background: transparent;
  font-size: 14px;
  cursor: pointer;
}
.sheet-action:hover {
  background: #f3f4f6;
}

/* Modal styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(4px);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.modal-content {
  background: white;
  width: 100%;
  max-width: 600px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  animation: modalPop 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes modalPop {
  from { transform: scale(0.95); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.modal-header {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid var(--border-subtle);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #fff;
}

.modal-body {
  padding: 1.5rem;
  overflow-y: auto;
  background: #F8FAFC;
  flex: 1;
}

.modal-footer {
  padding: 1.25rem 1.5rem;
  background: white;
  border-top: 1px solid var(--border-subtle);
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
}

/* ============= EDITOR SPECIFIC STYLES ============= */

.loading-state {
  text-align: center;
  padding: 4rem;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #E2E8F0;
  border-top: 4px solid var(--icon-active);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Toast */
#toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 3000;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  padding: 1rem 1.5rem;
  background: white;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.3s ease;
  display: flex;
  align-items: center;
  gap: 1rem;
  border-left: 4px solid var(--icon-active);
  min-width: 300px;
  pointer-events: auto;
}

.toast.success { border-left-color: var(--success-color); }
.toast.error { border-left-color: var(--danger-color); }
.toast.info { border-left-color: var(--icon-active); }

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Progress overlay */
#progress-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(8px);
  z-index: 9999;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
}

.progress-content {
  background: white;
  padding: 2rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-subtle);
  min-width: 300px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #E2E8F0;
  border-top: 4px solid var(--icon-active);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

/* Custom select */
.custom-select-container {
  position: relative;
}

.custom-select-trigger {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  cursor: pointer;
  background: white;
}

.custom-select-options {
  position: absolute;
  top: 105%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  z-index: 50;
  opacity: 0;
  pointer-events: none;
  transform: translateY(-10px);
  transition: var(--transition);
  max-height: 200px;
  overflow-y: auto;
}

.custom-select-options.open {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

.custom-option {
  padding: 0.75rem 1rem;
  cursor: pointer;
  transition: 0.1s;
}

.custom-option:hover {
  background: #F8FAFC;
  color: var(--icon-active);
}

/* Variant and Review cards */
.variant-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  margin-bottom: 0.75rem;
  background: #fff;
  transition: 0.2s;
}

.variant-swatch {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  border: 1px solid var(--border-subtle);
  object-fit: cover;
}

.review-card {
  padding: 1rem;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  margin-bottom: 0.75rem;
  background: #fff;
}

.review-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  font-weight: 600;
}

.star-display {
  color: var(--star-color);
  display: flex;
  gap: 2px;
  font-size: 1rem;
}

.review-text {
  font-size: 0.9rem;
  color: var(--text-secondary);
  line-height: 1.4;
}

/* Star rating input */
.star-rating-input {
  display: flex;
  gap: 0.5rem;
  font-size: 2rem;
  color: #CBD5E1;
  cursor: pointer;
  justify-content: center;
  margin: 1rem 0;
}

.star-rating-input i.active {
  color: var(--star-color);
}

/* Swatch upload */
.swatch-upload-container {
  width: 100px;
  height: 100px;
  border-radius: var(--radius-md);
  border: 2px dashed #CBD5E1;
  background: #F8FAFC;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  cursor: pointer;
  overflow: hidden;
  position: relative;
}

.swatch-upload-container img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: none;
}

.swatch-upload-container i {
  font-size: 2rem;
  color: var(--text-secondary);
  margin-bottom: 4px;
}

.swatch-upload-container span {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

/* Gallery grid */
.existing-gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.gallery-item {
  position: relative;
  width: 100%;
  aspect-ratio: 1;
  border-radius: var(--radius-md);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
}

.gallery-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.gallery-remove {
  position: absolute;
  top: 4px;
  right: 4px;
  background: rgba(255,255,255,0.9);
  color: var(--danger-color);
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  font-size: 1rem;
}

/* Size selection */
.size-option {
  border: 1px solid var(--border-subtle);
  border-radius: 6px;
  padding: 0.5rem;
  text-align: center;
  cursor: pointer;
  background: white;
  transition: var(--transition);
}

.size-option.selected {
  background: #EEF2FF;
  border-color: var(--icon-active);
}

/* ============= RESPONSIVE SWITCH ============= */

/* Desktop default, hide mobile */
.page-desktop { display: flex; }
.page-mobile  { display: none; }

@media (max-width: 768px) {
  .page-desktop { display: none; }
  .page-mobile  { display: flex; }
  .page-header { margin-bottom: 16px; }
  .form-grid { display: flex; flex-direction: column; }
  .content-inner { padding: 1rem; padding-bottom: 80px; }
  .mobile-save-bar { display: flex; gap: 0.5rem; }
  .mobile-save-bar button { flex: 1; }
  
  /* Hide desktop header actions on mobile */
  .page-header .primary-btn {
    display: none;
  }
  
  /* Mobile modal adjustments */
  .modal-overlay { align-items: flex-end; padding: 0; }
  .modal-content { 
    width: 100%; 
    max-width: 100%; 
    border-radius: 16px 16px 0 0 !important; 
    max-height: 85vh; 
    animation: slideUpModal 0.3s cubic-bezier(0.16, 1, 0.3, 1); 
  }
  .modal-body { padding-bottom: 3rem; }
  .modal-footer { padding-bottom: 2rem; border-top: 1px solid var(--border-subtle); }
  @keyframes slideUpModal { 
    from { transform: translateY(100%); } 
    to { transform: translateY(0); } 
  }
}
</style>
</head>
<body>

<!-- ================= DESKTOP VIEW ================= -->
<div class="page-desktop">

  <header class="d-topbar">
    <img class="d-topbar-logo"
         src="https://product-ecommerces.netlify.app/vastramaya.png"
         alt="Logo" />
  </header>

  <div class="d-app">

    <aside class="d-sidebar">
      <div class="d-sidebar-inner">

        <nav class="d-nav">
          <div class="d-nav-group">

            <!-- Dashboard (active) -->
            <div class="d-nav-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                     fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="7" height="7" x="3" y="3" rx="1"/>
                  <rect width="7" height="7" x="14" y="3" rx="1"/>
                  <rect width="7" height="7" x="14" y="14" rx="1"/>
                  <rect width="7" height="7" x="3" y="14" rx="1"/>
                </svg>
              </span>
              <span class="label">Dashboard</span>
            </div>

            <!-- Inventory (active) -->
            <div class="d-nav-item d-nav-item--active">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                     fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M2 7v10"/>
                  <path d="M6 5v14"/>
                  <rect width="12" height="18" x="10" y="3" rx="2"/>
                </svg>
              </span>
              <span class="label">Inventory</span>
            </div>

            <!-- Customize Site (with dropdown chevron) -->
            <div class="d-nav-item" id="d-customize-toggle">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                     fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12.034 12.681a.498.498 0 0 1 .647-.647l9 3.5a.5.5 0 0 1-.033.943l-3.444 1.068a1 1 0 0 0-.66.66l-1.067 3.443a.5.5 0 0 1-.943.033z"/>
                  <path d="M21 11V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6"/>
                </svg>
              </span>
              <span class="label">Customize Site</span>
              <span class="chevron">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round"
                     class="chevron-icon">
                  <path d="m9 18 6-6-6-6"/>
                </svg>
              </span>
            </div>

            <!-- Desktop Customize Site submenu -->
            <div class="d-submenu" id="d-customize-submenu">
              <div class="d-submenu-item active">Theme & layout</div>
              <div class="d-submenu-item">Sections</div>
              <div class="d-submenu-item">Navigation</div>
            </div>

            <!-- All Orders -->
            <div class="d-nav-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                     fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M16 22h2a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v2.85"/>
                  <path d="M14 2v5a1 1 0 0 0 1 1h5"/>
                  <path d="M8 14v2.2l1.6 1"/>
                  <circle cx="8" cy="16" r="6"/>
                </svg>
              </span>
              <span class="label">All Orders</span>
            </div>

          </div>
        </nav>

        <!-- Desktop Account section -->
        <div class="d-account-section">
          <div class="account-card">
            <img
              class="account-avatar"
              id="desktop-avatar"
              src="https://bpb-us-w2.wpmucdn.com/wp.wpi.edu/dist/e/505/files/2024/06/unknown-person-icon-3.png"
              alt="Profile" />
            <div class="account-text">
              <div class="account-name" id="desktop-name">Account sharing</div>
              <div class="account-email" id="desktop-email">demo@gmail.com</div>
            </div>
          </div>
        </div>

      </div>
    </aside>

    <main class="d-content">
      <div class="content-inner">

        <!-- PAGE HEADER -->
        <div class="page-header">
          <div class="page-title-wrap">
            <div class="page-title" id="editor-title">Product Editor</div>
            <div class="breadcrumb">
              <span class="breadcrumb-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round">
                  <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/>
                  <path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                </svg>
              </span>
              <span>Home</span>
              <span class="breadcrumb-divider">/</span>
              <span>Inventory</span>
              <span class="breadcrumb-divider">/</span>
              <span>Product Editor</span>
            </div>
          </div>

          <button class="primary-btn" id="desktop-save-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            <span>Save Product</span>
          </button>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="loading-state">
          <div class="loading-spinner"></div>
          <p style="margin-top: 1rem; color: var(--icon-color);">Loading editor...</p>
        </div>

        <!-- Product Form -->
        <form id="product-form" style="display:none;">
          <div class="form-grid">
            <div class="form-col">
              <!-- Cover Image -->
              <div class="editor-card" id="card-cover">
                <h3 class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                       fill="none" stroke="currentColor" stroke-width="2"
                       stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                  </svg>
                  Cover Image
                </h3>
                <div id="cover-upload-zone" class="upload-zone">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                       fill="none" stroke="currentColor" stroke-width="2"
                       stroke-linecap="round" stroke-linejoin="round" width="40" height="40" style="margin-bottom:0.5rem; stroke: var(--icon-active);">
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"/>
                    <line x1="16" y1="5" x2="22" y2="5"/>
                    <line x1="19" y1="2" x2="19" y2="8"/>
                    <polyline points="21 15 16 10 5 21"/>
                  </svg>
                  <div style="color:var(--icon-color); font-weight:500;">Click to upload cover image</div>
                  <div style="font-size:0.8rem; color:var(--icon-color); margin-top:0.25rem;">Single image only (Max 5MB)</div>
                </div>
                <input type="file" id="cover-input" accept="image/*" style="display:none;">
                <div id="cover-preview-wrapper" class="cover-preview-wrapper" style="display:none;">
                  <img id="cover-preview" class="cover-preview-img">
                  <button type="button" class="cover-remove-btn" onclick="removeCoverImage()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                      <polyline points="3 6 5 6 21 6"/>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Product Details -->
              <div class="editor-card" id="card-details">
                <h3 class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                       fill="none" stroke="currentColor" stroke-width="2"
                       stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                  </svg>
                  Product Details
                </h3>
                <div class="input-group">
                  <label class="input-label">Product Name *</label>
                  <input type="text" class="form-control" id="name" required placeholder="e.g. Classic Cotton Shirt">
                </div>
                <div class="input-group">
                  <label class="input-label">Category *</label>
                  <div id="category-select" class="custom-select-container"></div>
                  <input type="hidden" id="selected-category">
                </div>
                <div class="input-group">
                  <label class="input-label">Description</label>
                  <textarea class="form-control" id="description" rows="4" placeholder="Detailed product description..."></textarea>
                </div>
              </div>

              <!-- Color Variants -->
              <div class="editor-card" id="card-variants">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                  <h3 class="section-title" style="margin:0;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                      <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                    </svg>
                    Color Variants
                  </h3>
                  <button type="button" class="btn btn-primary btn-sm" onclick="openColorModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                      <line x1="12" y1="5" x2="12" y2="19"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    <span>Add</span>
                  </button>
                </div>
                <div id="variants-list"></div>
              </div>

              <!-- Customer Reviews -->
              <div class="editor-card" id="card-reviews">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                  <h3 class="section-title" style="margin:0;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                    Customer Reviews
                  </h3>
                  <button type="button" class="btn btn-primary btn-sm" onclick="openReviewModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                      <line x1="12" y1="5" x2="12" y2="19"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    <span>Add</span>
                  </button>
                </div>
                <div id="reviews-list"></div>
              </div>
            </div>

            <div class="form-col">
              <!-- Pricing -->
              <div class="editor-card" id="card-pricing">
                <h3 class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                       fill="none" stroke="currentColor" stroke-width="2"
                       stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                    <line x1="12" y1="1" x2="12" y2="23"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                  </svg>
                  Pricing
                </h3>
                <div class="input-group">
                  <label class="input-label">Current Price (₹) *</label>
                  <input type="number" class="form-control" id="price" step="0.01" required>
                </div>
                <div class="input-group">
                  <label class="input-label">Old Price (₹) *</label>
                  <input type="number" class="form-control" id="oldPrice" step="0.01" required>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </main>
  </div>
</div>

<!-- ================= MOBILE VIEW ================= -->
<div class="page-mobile">

  <!-- Mobile header: menu left, logo right -->
  <header class="m-header">
    <button class="m-menu-btn" id="m-menu-toggle" aria-label="Open menu">
      <div class="m-menu-lines"><span></span></div>
    </button>

    <img
      class="m-logo"
      src="https://product-ecommerces.netlify.app/vastramaya.png"
      alt="Logo" />
  </header>

  <main class="m-main">
    <div class="content-inner">

      <!-- PAGE HEADER -->
      <div class="page-header">
        <div class="page-title-wrap">
          <div class="page-title" id="mobile-editor-title">Product Editor</div>
          <div class="breadcrumb">
            <span class="breadcrumb-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/>
                <path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              </svg>
            </span>
            <span>Home</span>
            <span class="breadcrumb-divider">/</span>
            <span>Inventory</span>
            <span class="breadcrumb-divider">/</span>
            <span>Product Editor</span>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div id="mobile-loading-state" class="loading-state">
        <div class="loading-spinner"></div>
        <p style="margin-top: 1rem; color: var(--icon-color);">Loading editor...</p>
      </div>

      <!-- Product Form -->
      <form id="mobile-product-form" style="display:none;">
        <!-- Cover Image -->
        <div class="editor-card" id="mobile-card-cover">
          <h3 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            Cover Image
          </h3>
          <div id="mobile-cover-upload-zone" class="upload-zone">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" width="40" height="40" style="margin-bottom:0.5rem; stroke: var(--icon-active);">
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"/>
              <line x1="16" y1="5" x2="22" y2="5"/>
              <line x1="19" y1="2" x2="19" y2="8"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <div style="color:var(--icon-color); font-weight:500;">Click to upload cover image</div>
            <div style="font-size:0.8rem; color:var(--icon-color); margin-top:0.25rem;">Single image only (Max 5MB)</div>
          </div>
          <input type="file" id="mobile-cover-input" accept="image/*" style="display:none;">
          <div id="mobile-cover-preview-wrapper" class="cover-preview-wrapper" style="display:none;">
            <img id="mobile-cover-preview" class="cover-preview-img">
            <button type="button" class="cover-remove-btn" onclick="removeMobileCoverImage()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Product Details -->
        <div class="editor-card" id="mobile-card-details">
          <h3 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            Product Details
          </h3>
          <div class="input-group">
            <label class="input-label">Product Name *</label>
            <input type="text" class="form-control" id="mobile-name" required placeholder="e.g. Classic Cotton Shirt">
          </div>
          <div class="input-group">
            <label class="input-label">Category *</label>
            <div id="mobile-category-select" class="custom-select-container"></div>
            <input type="hidden" id="mobile-selected-category">
          </div>
          <div class="input-group">
            <label class="input-label">Description</label>
            <textarea class="form-control" id="mobile-description" rows="4" placeholder="Detailed product description..."></textarea>
          </div>
        </div>

        <!-- Color Variants -->
        <div class="editor-card" id="mobile-card-variants">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
            <h3 class="section-title" style="margin:0;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
              </svg>
              Color Variants
            </h3>
            <button type="button" class="btn btn-primary btn-sm" onclick="openColorModal()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              <span>Add</span>
            </button>
          </div>
          <div id="mobile-variants-list"></div>
        </div>

        <!-- Pricing -->
        <div class="editor-card" id="mobile-card-pricing">
          <h3 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            Pricing
          </h3>
          <div class="input-group">
            <label class="input-label">Current Price (₹) *</label>
            <input type="number" class="form-control" id="mobile-price" step="0.01" required>
          </div>
          <div class="input-group">
            <label class="input-label">Old Price (₹) *</label>
            <input type="number" class="form-control" id="mobile-oldPrice" step="0.01" required>
          </div>
        </div>

        <!-- Customer Reviews -->
        <div class="editor-card" id="mobile-card-reviews">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
            <h3 class="section-title" style="margin:0;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
              Customer Reviews
            </h3>
            <button type="button" class="btn btn-primary btn-sm" onclick="openReviewModal()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              <span>Add</span>
            </button>
          </div>
          <div id="mobile-reviews-list"></div>
        </div>
      </form>
    </div>
  </main>

  <!-- Mobile Save Bar -->
  <div class="mobile-save-bar">
    <button type="button" class="btn btn-secondary" onclick="window.history.back()">Cancel</button>
    <button type="button" class="btn btn-primary" id="mobile-save-btn">Save Product</button>
  </div>

  <!-- Overlay & drawer -->
  <div class="m-overlay" id="m-overlay">
    <div class="m-drawer">

      <div class="m-drawer-header">
        <img
          class="m-drawer-logo"
          src="https://product-ecommerces.netlify.app/vastramaya.png"
          alt="Logo" />
        <button class="m-drawer-close" id="m-drawer-close" aria-label="Close menu">
          <div class="m-drawer-close-icon"></div>
        </button>
      </div>

      <nav class="m-drawer-nav">

        <!-- Dashboard -->
        <div class="m-nav-item">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="7" height="7" x="3" y="3" rx="1"/>
              <rect width="7" height="7" x="14" y="3" rx="1"/>
              <rect width="7" height="7" x="14" y="14" rx="1"/>
              <rect width="7" height="7" x="3" y="14" rx="1"/>
            </svg>
          </span>
          <span class="label">Dashboard</span>
        </div>

        <!-- Inventory active -->
        <div class="m-nav-item active">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 7v10"/>
              <path d="M6 5v14"/>
              <rect width="12" height="18" x="10" y="3" rx="2"/>
            </svg>
          </span>
          <span class="label">Inventory</span>
        </div>

        <!-- Customize Site with dropdown -->
        <div class="m-nav-item" id="m-customize-toggle">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12.034 12.681a.498.498 0 0 1 .647-.647l9 3.5a.5.5 0 0 1-.033.943l-3.444 1.068a1 1 0 0 0-.66.66l-1.067 3.443a.5.5 0 0 1-.943.033z"/>
              <path d="M21 11V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6"/>
            </svg>
          </span>
          <span class="label">Customize Site</span>
          <span class="chevron">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round"
                 class="chevron-icon">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </span>
        </div>

        <!-- Mobile Customize Site submenu -->
        <div class="m-submenu" id="m-customize-submenu">
          <div class="m-submenu-item active">Theme & layout</div>
          <div class="m-submenu-item">Sections</div>
          <div class="m-submenu-item">Navigation</div>
        </div>

        <!-- All Orders -->
        <div class="m-nav-item">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 22h2a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v2.85"/>
              <path d="M14 2v5a1 1 0 0 0 1 1h5"/>
              <path d="M8 14v2.2l1.6 1"/>
              <circle cx="8" cy="16" r="6"/>
            </svg>
          </span>
          <span class="label">All Orders</span>
        </div>

      </nav>

      <!-- Mobile account sharing -->
      <div class="m-account-section">
        <div class="account-card">
          <img
            class="account-avatar"
            id="mobile-avatar"
            src="https://bpb-us-w2.wpmucdn.com/wp.wpi.edu/dist/e/505/files/2024/06/unknown-person-icon-3.png"
            alt="Profile" />
          <div class="account-text">
            <div class="account-name" id="mobile-name">Account sharing</div>
            <div class="account-email" id="mobile-email">demo@gmail.com</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Progress Overlay -->
<div id="progress-overlay">
  <div class="progress-content">
    <div class="spinner"></div>
    <h3 style="margin:0 0 0.5rem 0; font-size:1.1rem;" id="progress-title">Processing</h3>
    <p style="margin:0; color:var(--icon-color); font-size:0.9rem;" id="progress-desc">Please wait...</p>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Color Variant Modal -->
<div class="modal-overlay" id="color-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 style="font-size:1.25rem; font-weight:600;" id="color-modal-title">Add Variant</h3>
      <button class="btn-icon" onclick="closeColorModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <form id="color-form">
        <div class="input-group">
          <label class="input-label">Color Name *</label>
          <input type="text" class="form-control" id="color-name" placeholder="e.g. Midnight Blue" required>
        </div>
        <div class="input-group">
          <label class="input-label">Color Swatch (Image)</label>
          <div style="display:flex; gap:1rem; align-items:center; flex-wrap: wrap;">
            <div class="swatch-upload-container" onclick="document.getElementById('color-swatch-input').click()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="32" height="32" id="swatch-icon">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              <span id="swatch-text">Upload</span>
              <img id="swatch-preview">
            </div>
            <div style="flex:1; min-width: 200px;">
              <p style="font-size:0.85rem; color:var(--icon-color); margin-bottom:0.5rem;">Click the box to upload a color representation image.</p>
              <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('color-swatch-input').click()">Select File</button>
            </div>
            <input type="file" id="color-swatch-input" accept="image/*" style="display:none;">
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Available Sizes</label>
          <div id="size-selection" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap:0.5rem;"></div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeColorModal()">Cancel</button>
      <button type="button" class="btn btn-primary" onclick="saveColorVariant()">Save Variant</button>
    </div>
  </div>
</div>

<!-- Review Modal -->
<div class="modal-overlay" id="review-modal">
  <div class="modal-content" style="max-width:500px;">
    <div class="modal-header">
      <h3 style="font-size:1.25rem; font-weight:600;" id="review-modal-title">Add Customer Review</h3>
      <button class="btn-icon" onclick="closeReviewModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="input-group">
        <label class="input-label">Customer Name</label>
        <input type="text" class="form-control" id="review-name" placeholder="e.g. John Doe">
      </div>
      <div class="input-group" style="text-align:center;">
        <label class="input-label">Rating</label>
        <div class="star-rating-input" id="star-rating">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" width="24" height="24" data-val="1">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" width="24" height="24" data-val="2">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" width="24" height="24" data-val="3">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" width="24" height="24" data-val="4">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" width="24" height="24" data-val="5">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        </div>
        <input type="hidden" id="review-rating" value="0">
      </div>
      <div class="input-group">
        <label class="input-label">Comment</label>
        <textarea class="form-control" id="review-text" rows="4" placeholder="Write the review here..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeReviewModal()">Cancel</button>
      <button type="button" class="btn btn-primary" id="review-save-btn" onclick="addReview()">Add Review</button>
    </div>
  </div>
</div>

<!-- Bottom sheet for mobile card menu -->
<div class="sheet-overlay" id="sheet-overlay">
  <div class="bottom-sheet">
    <div class="sheet-header">
      <div class="sheet-title" id="sheet-title">Product actions</div>
      <button class="sheet-close-btn" id="sheet-close-btn"><span>×</span></button>
    </div>
    <div class="sheet-actions">
      <button class="sheet-action">Manage</button>
      <button class="sheet-action">View details</button>
      <button class="sheet-action">Disable</button>
      <button class="sheet-action">Cancel</button>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCdeonH3VytC21F3X6x0rCVCn2xXrGPoug",
    authDomain: "vastramaya---magic.firebaseapp.com",
    projectId: "vastramaya---magic",
    storageBucket: "vastramaya---magic.firebasestorage.app",
    messagingSenderId: "543460072082",
    appId: "1:543460072082:web:f3d1140e8f81ad338ae44b",
    measurementId: "G-E39VNDCFVE"
  };
  
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();
  const ADMIN_EMAIL = "harshavardhanjw@gmail.com";

  // Application State
  let allCategories = [];
  let coverImageFile = null;
  let colorVariants = [];
  let productReviews = [];
  let editingVariantIndex = null;
  let editingReviewIndex = null;
  let tempSwatchFile = null;
  let currentProductId = null;

  // ================= UI FUNCTIONS =================
  
  // Mobile drawer behavior
  const mOverlay = document.getElementById('m-overlay');
  const mMenuToggle = document.getElementById('m-menu-toggle');
  const mDrawerClose = document.getElementById('m-drawer-close');

  if (mMenuToggle && mOverlay && mDrawerClose) {
    mMenuToggle.addEventListener('click', () => {
      mOverlay.classList.add('open');
    });

    mDrawerClose.addEventListener('click', () => {
      mOverlay.classList.remove('open');
    });

    mOverlay.addEventListener('click', (e) => {
      if (e.target === mOverlay) {
        mOverlay.classList.remove('open');
      }
    });
  }

  // Desktop Customize Site dropdown
  const dCustomizeToggle = document.getElementById('d-customize-toggle');
  const dCustomizeSubmenu = document.getElementById('d-customize-submenu');

  if (dCustomizeToggle && dCustomizeSubmenu) {
    dCustomizeToggle.addEventListener('click', () => {
      dCustomizeSubmenu.classList.toggle('open');
      dCustomizeToggle.classList.toggle('dropdown-open');
    });
  }

  // Mobile Customize Site dropdown
  const mCustomizeToggle = document.getElementById('m-customize-toggle');
  const mCustomizeSubmenu = document.getElementById('m-customize-submenu');

  if (mCustomizeToggle && mCustomizeSubmenu) {
    mCustomizeToggle.addEventListener('click', () => {
      mCustomizeSubmenu.classList.toggle('open');
      mCustomizeToggle.classList.toggle('dropdown-open');
    });
  }

  // Make all toggles functional
  document.querySelectorAll('.toggle').forEach(toggle => {
    toggle.addEventListener('click', () => {
      toggle.classList.toggle('on');
    });
  });

  // Mobile bottom sheet for product card menu
  const sheetOverlay = document.getElementById('sheet-overlay');
  const sheetTitle = document.getElementById('sheet-title');
  const sheetCloseBtn = document.getElementById('sheet-close-btn');

  function openSheet(productName) {
    if (sheetTitle) sheetTitle.textContent = productName || 'Product actions';
    sheetOverlay.classList.add('open');
  }

  function closeSheet() {
    sheetOverlay.classList.remove('open');
  }

  if (sheetCloseBtn) {
    sheetCloseBtn.addEventListener('click', closeSheet);
  }

  if (sheetOverlay) {
    sheetOverlay.addEventListener('click', (e) => {
      if (e.target === sheetOverlay) {
        closeSheet();
      }
    });
  }

  // Also close sheet when clicking "Cancel" inside
  document.querySelectorAll('.sheet-action').forEach(action => {
    if (action.textContent.trim().toLowerCase() === 'cancel') {
      action.addEventListener('click', closeSheet);
    }
  });

  // ================= AUTHENTICATION =================
  
  auth.onAuthStateChanged(user => {
    if (!user || user.email !== ADMIN_EMAIL) {
      window.location.href = 'index.html';
      return;
    }
    initUI(user);
    loadEditor();
  });

  function initUI(user) {
    const name = user.displayName || 'Account sharing';
    const avatar = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=5127ba&color=fff`;
    
    // Update desktop
    document.getElementById('desktop-name').textContent = name;
    document.getElementById('desktop-email').textContent = user.email;
    document.getElementById('desktop-avatar').src = avatar;
    
    // Update mobile
    document.getElementById('mobile-name').textContent = name;
    document.getElementById('mobile-email').textContent = user.email;
    document.getElementById('mobile-avatar').src = avatar;
  }

  // ================= EDITOR FUNCTIONS =================
  
  async function loadEditor() {
    const params = new URLSearchParams(window.location.search);
    currentProductId = params.get('id');
    
    try {
      // Load categories
      const catSnap = await db.collection('categories').orderBy('name').get();
      allCategories = catSnap.docs.map(d => d.data().name);
      
      // Setup category dropdowns
      setupCategoryDropdown('category-select', 'cat-display', 'selected-category');
      setupCategoryDropdown('mobile-category-select', 'mobile-cat-display', 'mobile-selected-category');
      
      if (currentProductId) {
        // Edit existing product
        document.getElementById('editor-title').textContent = 'Edit Product';
        document.getElementById('mobile-editor-title').textContent = 'Edit Product';
        
        const doc = await db.collection('products').doc(currentProductId).get();
        if (doc.exists) {
          populateForm(doc.data());
        }
      } else {
        // New product
        document.getElementById('editor-title').textContent = 'New Product';
        document.getElementById('mobile-editor-title').textContent = 'New Product';
        showForm();
      }
    } catch (e) {
      console.error('Error loading editor:', e);
      showToast('Error loading data', 'error');
    }
  }

  function setupCategoryDropdown(containerId, displayId, hiddenId) {
    const container = document.getElementById(containerId);
    let html = `
      <div class="custom-select-trigger" onclick="toggleDropdown('${containerId}')">
        <span id="${displayId}">Select Category</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
          <path d="m6 9 6 6 6-6"/>
        </svg>
      </div>
      <div class="custom-select-options">
    `;
    allCategories.forEach(cat => html += `<div class="custom-option" onclick="selectCategory('${cat}', '${displayId}', '${hiddenId}')">${cat}</div>`);
    html += `</div>`;
    container.innerHTML = html;
  }

  function toggleDropdown(containerId) {
    const container = document.getElementById(containerId);
    const options = container.querySelector('.custom-select-options');
    options.classList.toggle('open');
  }

  function selectCategory(cat, displayId, hiddenId) {
    document.getElementById(hiddenId).value = cat;
    document.getElementById(displayId).textContent = cat;
    document.querySelectorAll('.custom-select-options').forEach(opt => opt.classList.remove('open'));
  }

  function showForm() {
    // Hide loading states
    document.getElementById('loading-state').style.display = 'none';
    document.getElementById('mobile-loading-state').style.display = 'none';
    
    // Show forms
    document.getElementById('product-form').style.display = 'block';
    document.getElementById('mobile-product-form').style.display = 'block';
    
    // Setup upload zones
    setupUploadZones();
  }

  function populateForm(data) {
    // Desktop form
    document.getElementById('name').value = data.name || '';
    document.getElementById('description').value = data.description || '';
    document.getElementById('price').value = data.price || '';
    document.getElementById('oldPrice').value = data.oldPrice || '';
    
    if (data.category) {
      selectCategory(data.category, 'cat-display', 'selected-category');
      selectCategory(data.category, 'mobile-cat-display', 'mobile-selected-category');
    }
    
    // Mobile form
    document.getElementById('mobile-name').value = data.name || '';
    document.getElementById('mobile-description').value = data.description || '';
    document.getElementById('mobile-price').value = data.price || '';
    document.getElementById('mobile-oldPrice').value = data.oldPrice || '';
    
    // Cover image
    const coverUrl = data.image || (data.images && data.images.length > 0 ? data.images[0] : null);
    if (coverUrl) {
      showCoverPreview(coverUrl);
    }
    
    // Variants and reviews
    colorVariants = data.colorVariants || [];
    productReviews = data.reviews || [];
    
    renderVariants();
    renderReviews();
    
    showForm();
  }

  function setupUploadZones() {
    // Desktop cover upload
    const desktopUploadZone = document.getElementById('cover-upload-zone');
    const desktopCoverInput = document.getElementById('cover-input');
    
    desktopUploadZone.addEventListener('click', () => desktopCoverInput.click());
    desktopCoverInput.addEventListener('change', handleCoverUpload);
    
    // Mobile cover upload
    const mobileUploadZone = document.getElementById('mobile-cover-upload-zone');
    const mobileCoverInput = document.getElementById('mobile-cover-input');
    
    mobileUploadZone.addEventListener('click', () => mobileCoverInput.click());
    mobileCoverInput.addEventListener('change', handleMobileCoverUpload);
  }

  function handleCoverUpload(e) {
    const file = e.target.files[0];
    if (file) handleCoverFile(file, 'desktop');
  }

  function handleMobileCoverUpload(e) {
    const file = e.target.files[0];
    if (file) handleCoverFile(file, 'mobile');
  }

  function handleCoverFile(file, type) {
    if (file.size > 5 * 1024 * 1024) {
      showToast('Image too large (Max 5MB)', 'error');
      return;
    }
    
    coverImageFile = file;
    const reader = new FileReader();
    reader.onload = (e) => {
      if (type === 'desktop') {
        showCoverPreview(e.target.result);
      } else {
        showMobileCoverPreview(e.target.result);
      }
    };
    reader.readAsDataURL(file);
  }

  function showCoverPreview(url) {
    document.getElementById('cover-preview').src = url;
    document.getElementById('cover-preview-wrapper').style.display = 'block';
    document.getElementById('cover-upload-zone').style.display = 'none';
    document.getElementById('cover-preview').dataset.url = url;
    
    // Sync with mobile
    document.getElementById('mobile-cover-preview').src = url;
    document.getElementById('mobile-cover-preview-wrapper').style.display = 'block';
    document.getElementById('mobile-cover-upload-zone').style.display = 'none';
    document.getElementById('mobile-cover-preview').dataset.url = url;
  }

  function showMobileCoverPreview(url) {
    document.getElementById('mobile-cover-preview').src = url;
    document.getElementById('mobile-cover-preview-wrapper').style.display = 'block';
    document.getElementById('mobile-cover-upload-zone').style.display = 'none';
    document.getElementById('mobile-cover-preview').dataset.url = url;
    
    // Sync with desktop
    document.getElementById('cover-preview').src = url;
    document.getElementById('cover-preview-wrapper').style.display = 'block';
    document.getElementById('cover-upload-zone').style.display = 'none';
    document.getElementById('cover-preview').dataset.url = url;
  }

  function removeCoverImage() {
    coverImageFile = null;
    document.getElementById('cover-input').value = '';
    document.getElementById('mobile-cover-input').value = '';
    
    document.getElementById('cover-preview').src = '';
    document.getElementById('cover-preview-wrapper').style.display = 'none';
    document.getElementById('cover-upload-zone').style.display = 'block';
    
    document.getElementById('mobile-cover-preview').src = '';
    document.getElementById('mobile-cover-preview-wrapper').style.display = 'none';
    document.getElementById('mobile-cover-upload-zone').style.display = 'block';
  }

  function removeMobileCoverImage() {
    removeCoverImage();
  }

  // ================= VARIANT FUNCTIONS =================
  
  function openColorModal(index = null) {
    editingVariantIndex = index;
    const isEdit = index !== null;
    const data = isEdit ? colorVariants[index] : {};
    
    document.getElementById('color-modal-title').textContent = isEdit ? 'Edit Variant' : 'Add Variant';
    document.getElementById('color-name').value = data.name || '';
    
    // Setup swatch preview
    const swatchImg = document.getElementById('swatch-preview');
    const swatchIcon = document.getElementById('swatch-icon');
    const swatchText = document.getElementById('swatch-text');
    
    if (data.hex && data.hex.includes('http')) {
      swatchImg.src = data.hex;
      swatchImg.style.display = 'block';
      swatchIcon.style.display = 'none';
      swatchText.style.display = 'none';
    } else {
      swatchImg.style.display = 'none';
      swatchIcon.style.display = 'block';
      swatchText.style.display = 'block';
    }
    
    // Setup size selection
    const sizesContainer = document.getElementById('size-selection');
    const SIZES = ['S', 'M', 'L', 'XL', '2XL'];
    sizesContainer.innerHTML = SIZES.map(size => {
      const existing = data.sizes?.find(s => s.name === size);
      return `
        <div class="size-option ${existing ? 'selected' : ''}" onclick="toggleSize(this)">
          <div style="font-weight:600;">${size}</div>
          <div style="font-size:0.7rem; color:var(--icon-color);">${existing && existing.available ? 'In Stock' : 'Select'}</div>
          <input type="checkbox" class="size-check" style="display:none;" value="${size}" ${existing ? 'checked' : ''}>
        </div>
      `;
    }).join('');

    tempSwatchFile = null;
    
    // Setup swatch upload
    document.getElementById('color-swatch-input').onchange = (e) => {
      const file = e.target.files[0];
      if(file) {
        tempSwatchFile = file;
        const prev = document.getElementById('swatch-preview');
        prev.src = URL.createObjectURL(file);
        prev.style.display = 'block';
        document.getElementById('swatch-icon').style.display = 'none';
        document.getElementById('swatch-text').style.display = 'none';
      }
    };
    
    document.getElementById('color-modal').style.display = 'flex';
  }

  function toggleSize(el) {
    const checkbox = el.querySelector('.size-check');
    const isSelected = !checkbox.checked;
    checkbox.checked = isSelected;
    el.classList.toggle('selected');
    el.querySelector('div:nth-child(2)').textContent = isSelected ? 'In Stock' : 'Select';
  }

  function closeColorModal() {
    document.getElementById('color-modal').style.display = 'none';
    editingVariantIndex = null;
  }

  async function saveColorVariant() {
    const name = document.getElementById('color-name').value;
    if (!name) {
      showToast('Color name required', 'error');
      return;
    }
    
    showProgress('Saving Variant', 'Uploading swatch image...');

    try {
      let hex = '';
      if (tempSwatchFile) {
        hex = await uploadFile(tempSwatchFile, 'swatches');
      } else {
        // Check if editing and has existing hex
        if (editingVariantIndex !== null && colorVariants[editingVariantIndex]?.hex) {
          hex = colorVariants[editingVariantIndex].hex;
        }
      }

      let sizes = [];
      document.querySelectorAll('.size-check').forEach(cb => {
        if (cb.checked) {
          sizes.push({ name: cb.value, available: true });
        }
      });

      const variant = { name, hex, sizes };
      if (editingVariantIndex !== null) {
        colorVariants[editingVariantIndex] = variant;
      } else {
        colorVariants.push(variant);
      }
      
      renderVariants();
      closeColorModal();
      showToast('Variant Saved', 'success');
    } catch(e) {
      console.error('Error saving variant:', e);
      showToast('Failed to save variant', 'error');
    } finally {
      hideProgress();
    }
  }

  function renderVariants() {
    const desktopContainer = document.getElementById('variants-list');
    const mobileContainer = document.getElementById('mobile-variants-list');
    
    if (colorVariants.length === 0) {
      const emptyMsg = `<div style="text-align:center; color:var(--icon-color); padding:1rem; font-style:italic;">No variants yet.</div>`;
      desktopContainer.innerHTML = emptyMsg;
      mobileContainer.innerHTML = emptyMsg;
      return;
    }
    
    const variantHtml = colorVariants.map((v, i) => `
      <div class="variant-card">
        <div style="display:flex; align-items:center; gap:1rem;">
          <div class="variant-swatch" style="background: ${v.hex || '#f3f4f6'}; ${v.hex && v.hex.includes('http') ? `background-image: url('${v.hex}'); background-size: cover;` : ''}"></div>
          <div>
            <div style="font-weight:600;">${v.name}</div>
            <div style="font-size:0.8rem; color:var(--icon-color);">${v.sizes?.length || 0} sizes</div>
          </div>
        </div>
        <div style="display:flex; gap:0.5rem;">
          <button type="button" class="btn-icon" onclick="openColorModal(${i})">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </button>
          <button type="button" class="btn-icon btn-danger-icon" onclick="removeVariant(${i})">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
          </button>
        </div>
      </div>
    `).join('');
    
    desktopContainer.innerHTML = variantHtml;
    mobileContainer.innerHTML = variantHtml;
  }

  function removeVariant(i) {
    if(confirm('Remove this variant?')) {
      colorVariants.splice(i, 1);
      renderVariants();
    }
  }

  // ================= REVIEW FUNCTIONS =================
  
  function openReviewModal(index = null) {
    editingReviewIndex = index;
    const isEdit = index !== null;
    
    if(isEdit && productReviews[index]) {
      const rev = productReviews[index];
      document.getElementById('review-name').value = rev.name;
      document.getElementById('review-text').value = rev.comment;
      document.getElementById('review-rating').value = rev.rating;
      updateStars(rev.rating);
      document.getElementById('review-modal-title').textContent = 'Edit Review';
      document.getElementById('review-save-btn').textContent = 'Update Review';
    } else {
      document.getElementById('review-name').value = '';
      document.getElementById('review-text').value = '';
      document.getElementById('review-rating').value = '0';
      updateStars(0);
      document.getElementById('review-modal-title').textContent = 'Add Customer Review';
      document.getElementById('review-save-btn').textContent = 'Add Review';
    }
    
    // Setup star rating
    document.querySelectorAll('#star-rating svg').forEach(star => {
      star.onclick = function() {
        const val = parseInt(this.dataset.val);
        document.getElementById('review-rating').value = val;
        updateStars(val);
      }
    });
    
    document.getElementById('review-modal').style.display = 'flex';
  }

  function closeReviewModal() {
    document.getElementById('review-modal').style.display = 'none';
    editingReviewIndex = null;
  }

  function updateStars(val) {
    document.querySelectorAll('#star-rating svg').forEach(s => {
      const isActive = parseInt(s.dataset.val) <= val;
      s.style.stroke = isActive ? 'var(--star-color)' : '#CBD5E1';
      s.style.fill = isActive ? 'var(--star-color)' : 'none';
    });
  }

  function addReview() {
    const name = document.getElementById('review-name').value.trim();
    const rating = parseInt(document.getElementById('review-rating').value);
    const comment = document.getElementById('review-text').value.trim();
    
    if (!name || rating === 0 || !comment) {
      showToast('Please fill all fields', 'error');
      return;
    }
    
    const reviewData = { 
      name, 
      rating, 
      comment, 
      date: new Date().toISOString().split('T')[0] 
    };
    
    if(editingReviewIndex !== null) {
      productReviews[editingReviewIndex] = reviewData;
      showToast('Review updated', 'success');
    } else {
      productReviews.push(reviewData);
      showToast('Review added', 'success');
    }
    
    renderReviews();
    closeReviewModal();
  }

  function renderReviews() {
    const desktopContainer = document.getElementById('reviews-list');
    const mobileContainer = document.getElementById('mobile-reviews-list');
    
    if (!productReviews || productReviews.length === 0) {
      const emptyMsg = `<div style="color:var(--icon-color); font-style:italic; padding:1rem; text-align:center;">No reviews added yet.</div>`;
      desktopContainer.innerHTML = emptyMsg;
      mobileContainer.innerHTML = emptyMsg;
      return;
    }
    
    const reviewHtml = productReviews.map((r, i) => `
      <div class="review-card">
        <div class="review-header">
          <span>${r.name}</span>
          <div style="display:flex; gap:0.5rem;">
            <button type="button" class="btn-icon" onclick="openReviewModal(${i})">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
            <button type="button" class="btn-icon btn-danger-icon" onclick="removeReview(${i})">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="star-display">
          ${Array(5).fill(0).map((_, idx) => 
            idx < r.rating ? 
            `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--star-color)" stroke="var(--star-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>` : 
            `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#CBD5E1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`
          ).join('')}
        </div>
        <div class="review-text" style="margin-top:0.5rem;">${r.comment}</div>
        <div style="font-size:0.8rem; color:var(--icon-color); margin-top:0.5rem;">${r.date}</div>
      </div>
    `).join('');
    
    desktopContainer.innerHTML = reviewHtml;
    mobileContainer.innerHTML = reviewHtml;
  }

  function removeReview(index) {
    if(confirm("Delete this review?")) {
      productReviews.splice(index, 1);
      renderReviews();
    }
  }

  // ================= FILE UPLOAD =================
  
  async function uploadFile(file, path) {
    const ref = storage.ref().child(`${path}/${Date.now()}-${file.name}`);
    await ref.put(file);
    return await ref.getDownloadURL();
  }

  // ================= SAVE PRODUCT =================
  
  async function saveProduct() {
    // Get form data (use desktop as source, they should be synced)
    const name = document.getElementById('name').value;
    const price = document.getElementById('price').value;
    const category = document.getElementById('selected-category').value;
    const oldPrice = document.getElementById('oldPrice').value;
    const description = document.getElementById('description').value;
    
    // Validation
    if (!name || !price || !category || !oldPrice) {
      showToast('Please fill all required fields', 'error');
      return;
    }
    
    if (!coverImageFile && !document.getElementById('cover-preview').dataset.url) {
      showToast('Cover image is required', 'error');
      return;
    }

    showProgress('Saving Product', 'Uploading images and saving data...');

    try {
      // Upload cover image if new
      let coverUrl = document.getElementById('cover-preview').dataset.url;
      if (coverImageFile) {
        coverUrl = await uploadFile(coverImageFile, 'products');
      }

      // Prepare product data
      const productData = {
        name,
        description,
        category,
        price: parseFloat(price),
        oldPrice: parseFloat(oldPrice),
        image: coverUrl,
        images: [coverUrl],
        colorVariants,
        reviews: productReviews,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };

      if (currentProductId) {
        // Update existing product
        await db.collection('products').doc(currentProductId).update(productData);
        showToast('Product Updated Successfully!', 'success');
      } else {
        // Create new product
        productData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
        await db.collection('products').add(productData);
        showToast('Product Created Successfully!', 'success');
      }
      
      // Redirect back after delay
      setTimeout(() => window.history.back(), 1500);
    } catch (e) {
      console.error('Error saving product:', e);
      showToast('Save Failed', 'error');
    } finally {
      hideProgress();
    }
  }

  // ================= UTILITY FUNCTIONS =================
  
  function showProgress(title, desc) {
    document.getElementById('progress-title').textContent = title;
    document.getElementById('progress-desc').textContent = desc;
    document.getElementById('progress-overlay').style.display = 'flex';
  }

  function hideProgress() {
    document.getElementById('progress-overlay').style.display = 'none';
  }

  function showToast(msg, type = 'success') {
    const container = document.getElementById('toast-container');
    const el = document.createElement('div');
    el.className = `toast ${type}`;
    el.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round" width="20" height="20"
           style="stroke: ${type === 'success' ? 'var(--success-color)' : type === 'error' ? 'var(--danger-color)' : 'var(--icon-active)'}">
        ${type === 'success' ? 
          '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>' :
          type === 'error' ?
          '<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>' :
          '<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>'
        }
      </svg>
      <span>${msg}</span>
    `;
    container.appendChild(el);
    setTimeout(() => el.remove(), 3000);
  }

  // ================= EVENT LISTENERS =================
  
  document.addEventListener('DOMContentLoaded', () => {
    // Save buttons
    document.getElementById('desktop-save-btn').addEventListener('click', saveProduct);
    document.getElementById('mobile-save-btn').addEventListener('click', saveProduct);
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.custom-select-container')) {
        document.querySelectorAll('.custom-select-options').forEach(opt => {
          opt.classList.remove('open');
        });
      }
    });
  });
</script>
</body>
</html>
